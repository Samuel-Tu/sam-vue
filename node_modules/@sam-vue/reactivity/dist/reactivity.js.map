{
  "version": 3,
  "sources": ["../src/warn.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactivity.ts"],
  "sourcesContent": ["export default function warn(content: string) {\r\n  console.warn(content);\r\n}\r\n", "export function isObject(value: unknown) {\r\n  return typeof value === \"object\" && value !== null;\r\n}\r\n", "import { targetMap } from \"./reactiveEffect\";\r\n\r\nfunction preCleanEffect(effect: ReactiveEffect) {\r\n  effect._depLength = 0;\r\n  effect._trackId++;\r\n}\r\n\r\nfunction cleanDepEffect(dep, effect) {\r\n  dep.delete(effect);\r\n  if (dep.size === 0) {\r\n    dep.cleanup();\r\n  }\r\n}\r\n\r\nclass ReactiveEffect {\r\n  _trackId = 0;\r\n  public active = true;\r\n  _depLength = 0;\r\n  deps = [];\r\n\r\n  constructor(public fn, public scheduler) {}\r\n\r\n  run() {\r\n    if (!this.active) return this.fn();\r\n    let lastReactiveEffect = currentReactiveEffect;\r\n    try {\r\n      debugger;\r\n      currentReactiveEffect = this;\r\n      preCleanEffect(this);\r\n      return this.fn();\r\n    } finally {\r\n      currentReactiveEffect = lastReactiveEffect;\r\n    }\r\n  }\r\n}\r\n\r\nexport let currentReactiveEffect;\r\n\r\nexport function effect(fn, option?) {\r\n  const _effect = new ReactiveEffect(fn, () => {\r\n    _effect.run();\r\n  });\r\n\r\n  _effect.run();\r\n\r\n  return _effect;\r\n}\r\n\r\nexport function trackEffect(effect, dep) {\r\n  if (dep.get(effect) !== effect._trackId) {\r\n    dep.set(effect, effect._trackId);\r\n    //   const oleDep = effect.deps[effect._depLength];\r\n    //   if (oleDep !== dep) {\r\n    //     if (oleDep) {\r\n    //       cleanDepEffect(dep, effect);\r\n    //     }\r\n    //     effect.deps[effect._depLength++] = dep;\r\n    //   } else {\r\n    //     effect._depLength++;\r\n    //   }\r\n  }\r\n  dep.set(effect, effect._trackId);\r\n  effect.deps[effect._depLength++] = dep;\r\n  // debugger;\r\n  console.log(effect.deps, \"deps\");\r\n}\r\n\r\nexport function triggerEffects(dep) {\r\n  for (const effect of dep.keys()) {\r\n    if (effect.scheduler) {\r\n      console.log(effect, \"effect\");\r\n      console.log(targetMap, \"targetMap\");\r\n      effect.scheduler();\r\n    }\r\n  }\r\n}\r\n", "import { currentReactiveEffect, trackEffect, triggerEffects } from \"./effect\";\r\nexport const targetMap = new WeakMap();\r\n\r\ninterface Dep extends Map<any, any> {\r\n  cleanup: () => void;\r\n  name: string;\r\n}\r\n\r\nexport const createDep = (cleanup: () => void, name: string) => {\r\n  const dep = new Map() as Dep;\r\n  dep.cleanup = cleanup;\r\n  dep.name = name;\r\n  return dep;\r\n};\r\n\r\nexport function track(target, property) {\r\n  if (currentReactiveEffect) {\r\n    let propertyMap = targetMap.get(target);\r\n    if (!propertyMap) {\r\n      targetMap.set(target, (propertyMap = new Map()));\r\n    }\r\n\r\n    let depsMap = propertyMap.get(property);\r\n    if (!depsMap) {\r\n      propertyMap.set(\r\n        property,\r\n        (depsMap = createDep(() => depsMap.delete(property), property))\r\n      );\r\n    }\r\n\r\n    trackEffect(currentReactiveEffect, depsMap);\r\n  }\r\n}\r\n\r\nexport function trigger(target, property, newValue, oldValue) {\r\n  const depsMap = targetMap.get(target);\r\n  if (!depsMap) {\r\n    return;\r\n  }\r\n\r\n  const propertyMap = depsMap.get(property);\r\n  if (propertyMap) {\r\n    triggerEffects(propertyMap);\r\n  }\r\n}\r\n", "import { ReactiveFlags } from \"./reactivity\";\r\nimport { track, trigger } from \"./reactiveEffect\";\r\n\r\n// proxy \u9700\u8981\u642D\u914D Reflect \u4F7F\u7528\r\nexport const proxyHandler: ProxyHandler<any> = {\r\n  get(target, property, receiver) {\r\n    if (property === ReactiveFlags.IS_REACTIVE) {\r\n      return true;\r\n    }\r\n\r\n    //\u4F9D\u8D56\u6536\u96C6\r\n    track(target, property);\r\n\r\n    // \u5982\u679C\u76F4\u63A5\u8BBE\u7F6E target[property] , \u8FD9\u6837\u5728\u5BF9\u8C61\u4E2D\u8BBF\u95EE this \u6307\u5411\u7684\u4E0D\u662F\u5176\u4EE3\u7406\u5BF9\u8C61\uFF0C\u800C\u662F\u539F\u5BF9\u8C61\uFF0C\u6B64\u65F6\u4E0D\u4F1A\u89E6\u53D1 get\r\n    return Reflect.get(target, property, receiver);\r\n  },\r\n  set(target, property, value, receiver) {\r\n    let oldValue = target[property];\r\n\r\n    Reflect.set(target, property, value, receiver);\r\n\r\n    let newValue = target[property];\r\n\r\n    if (oldValue !== newValue) {\r\n      //\u89E6\u53D1\u66F4\u65B0\r\n      trigger(target, property, newValue, oldValue);\r\n    }\r\n\r\n    return Reflect.set(target, property, value, receiver);\r\n  },\r\n};\r\n", "import warn from \"./warn\";\r\nimport { isObject } from \"@vue/shared/src\";\r\nimport { proxyHandler } from \"./baseHandler\";\r\n\r\nexport interface Target {\r\n  [ReactiveFlags.IS_REACTIVE]?: Boolean;\r\n}\r\n\r\nexport enum ReactiveFlags {\r\n  IS_REACTIVE = \"__v_isReactive\",\r\n}\r\n\r\nconst reactiveMap = new WeakMap();\r\n\r\nexport function reactive(target: object) {\r\n  return createReactiveObject(target);\r\n}\r\n\r\nfunction createReactiveObject(target: Target) {\r\n  if (!isObject(target)) {\r\n    warn(`the target is not a object: ${target}`);\r\n    return target;\r\n  }\r\n\r\n  if (target[ReactiveFlags.IS_REACTIVE]) {\r\n    return target;\r\n  }\r\n\r\n  const existProxy = reactiveMap.get(target);\r\n  if (existProxy) {\r\n    return existProxy;\r\n  }\r\n\r\n  const proxy = new Proxy(target, proxyHandler);\r\n\r\n  reactiveMap.set(target, proxy);\r\n\r\n  return proxy;\r\n}\r\n"],
  "mappings": "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",
  "names": ["effect", "effect"]
}
